<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Attendance & Curriculum</title>

  <!-- QR libraries -->
  <script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 0;
      background: #f4f4f9;
    }

    .page {
      display: none;
      padding: 20px;
    }
    .page h1 {
      margin-bottom: 20px;
    }
    .hidden {
      display: none;
    }

    input {
      display: block;
      margin: 10px auto;
      padding: 10px;
      width: 200px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    button {
      padding: 10px 20px;
      margin: 10px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      background: #0056b3;
      transform: scale(1.05);
    }

    table {
      margin: 20px auto;
      border-collapse: collapse;
      width: 80%;
      background: #fff;
      border-radius: 6px;
      overflow: hidden;
    }
    th, td {
      padding: 10px;
      text-align: center;
      border: 1px solid #ddd;
    }
    th {
      background: #007bff;
      color: white;
    }
    tr:nth-child(even) {
      background: #f9f9f9;
    }
  </style>
</head>
<body>
  <!-- Landing -->
  <section id="home" class="page">
    <h1>🎓 Smart Attendance & Curriculum</h1>
    <button onclick="showPage('teacherLoginPage')">Teacher Login</button>
    <button onclick="showPage('studentLoginPage')">Student Login</button>
  </section>

  <!-- Teacher Login -->
  <section id="teacherLoginPage" class="page hidden">
    <h1>👨‍🏫 Teacher Login</h1>
    <input type="text" id="teacherUser" placeholder="Username">
    <input type="password" id="teacherPass" placeholder="Password">
    <button onclick="teacherLogin()">Login</button>
    <p id="teacherMsg"></p>
    <button onclick="showPage('home')">⬅️ Back</button>
  </section>

  <!-- Teacher Dashboard -->
  <section id="teacherDashboard" class="page hidden">
    <h1>📊 Teacher Dashboard</h1>
    <p>Welcome, <span id="teacherName"></span></p>

    <h2>Attendance Today: <span id="attendanceCount">0</span></h2>

    <table>
      <thead>
        <tr>
          <th>Student</th>
          <th>Subject</th>
          <th>Class</th>
          <th>Date</th>
        </tr>
      </thead>
      <tbody id="attendanceTable"></tbody>
    </table>

    <button onclick="showPage('teacherPortal')">🎯 Go to QR Generator</button>
    <a href="#" onclick="logout('teacher')">🚪 Logout</a>
  </section>

  <!-- Teacher Portal -->
  <section id="teacherPortal" class="page hidden">
    <h1>🎯 Teacher Portal</h1>
    <input type="text" id="subject" placeholder="Subject">
    <input type="text" id="className" placeholder="Class">
    <button onclick="generateQR()">Generate QR</button>
    <div id="qrcode"></div>
    <button onclick="showPage('teacherDashboard')">⬅️ Back to Dashboard</button>
  </section>

  <!-- Student Login -->
  <section id="studentLoginPage" class="page hidden">
    <h1>👩‍🎓 Student Login</h1>
    <input type="text" id="studentUser" placeholder="Username">
    <input type="password" id="studentPass" placeholder="Password">
    <button onclick="studentLogin()">Login</button>
    <p id="studentMsg"></p>
    <button onclick="showPage('home')">⬅️ Back</button>
  </section>

  <!-- Student Portal -->
  <section id="student" class="page hidden">
    <h1>👩‍🎓 Student Portal</h1>
    <button onclick="startScan()">📷 Scan Attendance QR</button>
    <div id="reader" style="display:none;"></div>
    <p id="result">Click the button above to start scanning</p>

    <button onclick="showPage('studentHistory')">📖 View Attendance History</button>
    <button onclick="showPage('curriculum')">📘 View Curriculum</button>

    <a href="#" onclick="logout('student')">🚪 Logout</a>
  </section>

  <!-- Student History -->
  <section id="studentHistory" class="page hidden">
    <h1>📖 My Attendance History</h1>
    <table>
      <thead>
        <tr>
          <th>Teacher</th>
          <th>Subject</th>
          <th>Class</th>
          <th>Date</th>
        </tr>
      </thead>
      <tbody id="historyTable"></tbody>
    </table>
    <button onclick="loadStudentHistory()">🔄 Refresh</button>
    <button onclick="showPage('student')">⬅️ Back to Portal</button>
  </section>

  <!-- Curriculum -->
  <section id="curriculum" class="page hidden">
    <h1>📘 Personalised Curriculum</h1>
    <p>Based on your profile interests, recommended curriculum appears here.</p>
    <button onclick="showPage('student')">⬅️ Back to Portal</button>
  </section>

  <script>
    function showPage(id) {
      document.querySelectorAll(".page").forEach(p => p.classList.add("hidden"));
      document.getElementById(id).classList.remove("hidden");
    }

    // Teacher login
    function teacherLogin() {
      let user = document.getElementById("teacherUser").value;
      let pass = document.getElementById("teacherPass").value;
      if (user === "teacher" && pass === "1234") {
        localStorage.setItem("teacherLoggedIn", "true");
        document.getElementById("teacherName").innerText = user;
        showPage("teacherDashboard");
        updateDashboard();
      } else {
        document.getElementById("teacherMsg").innerText = "❌ Invalid credentials!";
      }
    }

    // Student login
    function studentLogin() {
      let user = document.getElementById("studentUser").value;
      let pass = document.getElementById("studentPass").value;
      if (user === "student" && pass === "1234") {
        localStorage.setItem("studentLoggedIn", "true");
        localStorage.setItem("studentName", user);
        showPage("student");
      } else {
        document.getElementById("studentMsg").innerText = "❌ Invalid credentials!";
      }
    }

    // Teacher QR generator
    function generateQR() {
      let subject = document.getElementById("subject").value;
      let className = document.getElementById("className").value;
      let teacherName = document.getElementById("teacherName").innerText;

      let qrData = JSON.stringify({ teacherName, subject, className, date: new Date().toLocaleString() });

      document.getElementById("qrcode").innerHTML = "";
      new QRCode(document.getElementById("qrcode"), qrData);
    }

    // Student QR scanner
    function startScan() {
      document.getElementById("reader").style.display = "block";
      let html5QrCode = new Html5Qrcode("reader");

      html5QrCode.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: 250 },
        qrCodeMessage => {
          onScanSuccess(qrCodeMessage);
          html5QrCode.stop();
          document.getElementById("reader").style.display = "none";
        }
      );
    }

    function onScanSuccess(qrMessage) {
      try {
        let data = JSON.parse(qrMessage);
        let studentName = localStorage.getItem("studentName") || "Unknown Student";

        let records = JSON.parse(localStorage.getItem("attendanceRecords")) || [];
        records.push({
          teacherName: data.teacherName,
          subject: data.subject,
          className: data.className,
          date: data.date,
          student: studentName
        });
        localStorage.setItem("attendanceRecords", JSON.stringify(records));

        let history = JSON.parse(localStorage.getItem("attendanceHistory")) || [];
        history.push({
          teacherName: data.teacherName,
          subject: data.subject,
          className: data.className,
          date: data.date
        });
        localStorage.setItem("attendanceHistory", JSON.stringify(history));

        document.getElementById("result").innerText = "✅ Attendance marked!";
      } catch (e) {
        document.getElementById("result").innerText = "⚠️ Invalid QR!";
      }
    }

    // Student history
    function loadStudentHistory() {
      let history = JSON.parse(localStorage.getItem("attendanceHistory")) || [];
      let tbody = document.getElementById("historyTable");
      tbody.innerHTML = "";

      if (history.length === 0) {
        tbody.innerHTML = "<tr><td colspan='4'>No attendance records</td></tr>";
      } else {
        history.forEach(r => {
          let row = document.createElement("tr");
          row.innerHTML = `
            <td>${r.teacherName}</td>
            <td>${r.subject}</td>
            <td>${r.className}</td>
            <td>${r.date}</td>
          `;
          tbody.appendChild(row);
        });
      }
    }

    // Teacher dashboard
    function updateDashboard() {
      let records = JSON.parse(localStorage.getItem("attendanceRecords")) || [];
      let today = new Date().toISOString().slice(0, 10);

      let todayCount = records.filter(r => r.date.includes(today)).length;
      document.getElementById("attendanceCount").innerText = todayCount;

      let tableBody = document.getElementById("attendanceTable");
      tableBody.innerHTML = "";
      records.forEach(r => {
        let row = `<tr>
          <td>${r.student}</td>
          <td>${r.subject}</td>
          <td>${r.className}</td>
          <td>${r.date}</td>
        </tr>`;
        tableBody.innerHTML += row;
      });
    }

    function logout(role) {
      if (role === "teacher") localStorage.removeItem("teacherLoggedIn");
      if (role === "student") localStorage.removeItem("studentLoggedIn");
      showPage("home");
    }

    // Start with home
    showPage("home");
  </script>
</body>
</html>

